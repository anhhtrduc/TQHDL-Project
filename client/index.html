<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <title>Trực quan hoá dữ liệu</title>
    </head>
    <body>
        <script>
            // d3.json('http://localhost:36001/api/book', (error, data) => {
            //     console.log(data);
            //     d3.select('body')
            //         .selectAll('p')
            //         .data(data)
            //         .enter()
            //         .append('p')
            //         .text((d, i) => {
            //             return d;
            //         });
            // });
            d3.json('http://localhost:3000/api/', (error, data) => {
                var svg = d3.select('svg'),
                    margin = 200,
                    width = svg.attr('width') - margin,
                    height = svg.attr('height') - margin;
                var xScale = d3.scaleBand().range([0, width]).padding(0.4);
                var yScale = d3.scaleLinear().range([height, 0]);
                var g = svg
                    .append('g')
                    .attr('transform', 'translate(' + 100 + ',' + 100 + ')');
                console.log(data);
                xScale.domain(
                    data.map((d) => {
                        return d.year;
                    })
                );
                yScale.domain([
                    0,
                    d3.max(data, (d) => {
                        return d.quantity;
                    }),
                ]);
                g.append('g')
                    .attr('transform', 'translate(0,' + height + ')')
                    .call(d3.axisBottom(xScale));
                g.append('g').call(
                    d3
                        .axisLeft(yScale)
                        .tickFormat((d) => {
                            return d;
                        })
                        .ticks(10)
                );
                g.append('g')
                    .attr('transform', 'translate(0,' + height + ')')
                    .call(d3.axisBottom(xScale))
                    .append('text')
                    .attr('y', height - 250)
                    .attr('x', width - 100)
                    .attr('text-anchor', 'end')
                    .attr('stroke', 'black')
                    .text('Population');
                g.selectAll('.bar')
                    .data(data)
                    .enter()
                    .append('rect')
                    .attr('class', 'bar')
                    .attr('x', (d) => {
                        return xScale(d.year);
                    })
                    .attr('y', (d) => {
                        return yScale(d.quantity);
                    })
                    .attr('width', xScale.bandwidth())
                    .attr('height', (d) => {
                        return height - yScale(d.quantity);
                    });
            });
        </script>
    </body>
</html>
